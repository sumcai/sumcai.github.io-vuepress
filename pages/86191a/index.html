<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cmake 详解 | IOGL</title>
<meta name="generator" content="VuePress 1.8.0">
<link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-alpha/dist/katex.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_2937112_484nc9f03bi.css">
<meta name="description" content="这里将深入探讨相关技术，包括行业动态，架构设计，设计模式，框架使用，源码分析等。">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Cmake 详解">
    <meta property="og:description" content="">
    <meta property="og:url" content="http://www.iogl.cn/03.%E7%A2%8E%E7%89%87/09.%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/02.%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7/04.Cmake%E4%BD%BF%E7%94%A8.html">
    <meta property="og:site_name" content="iogl.cn">
    <meta property="article:published_time" content="2021-01-14T15:23:40.000Z">
    <meta property="article:tag" content="cmake">
    <meta itemprop="name" content="Cmake 详解">
    <meta itemprop="description" content="">
    <meta name="keywords" content="个人技术博客,算法,数据结构">
    <meta name="theme-color" content="#11a8cd">
<link rel="preload" href="/assets/css/0.styles.b17c35c4.css" as="style"><link rel="preload" href="/assets/js/app.29891e4d.js" as="script"><link rel="preload" href="/assets/js/2.a7472eed.js" as="script"><link rel="preload" href="/assets/js/4.705083b4.js" as="script"><link rel="preload" href="/assets/js/53.72f8b89b.js" as="script">
<link rel="stylesheet" href="/assets/css/0.styles.b17c35c4.css">
</head>
<body class="theme-mode-light">
<div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/avatar.png" alt="IOGL" class="logo"> <span class="site-name can-hide"></span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📚笔记" class="dropdown-title"><a href="/site/note/" class="link-title">📚笔记</a> <span class="title" style="display:none;">📚笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opengl/" class="nav-link">OpenGL技术</a></li><li class="dropdown-item"><!----> <a href="/vulkan/" class="nav-link">Vulkan技术</a></li><li class="dropdown-item"><!----> <a href="/physics/" class="nav-link">物理引擎技术</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖教程" class="dropdown-title"><a href="/site/tutorial/" class="link-title">📖教程</a> <span class="title" style="display:none;">📖教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/site/tutorial/learnopengl/" class="nav-link">OpenGL中文教程</a></li></ul></div></div><div class="nav-item"><a href="/site/tips/" class="nav-link">✏️碎片</a></div><div class="nav-item"><a href="/site/msgboard/" class="nav-link">📋留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧭导航" class="dropdown-title"><a href="/archives/" class="link-title">🧭导航</a> <span class="title" style="display:none;">🧭导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">📂分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">🔖标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">⌚时间线</a></li><li class="dropdown-item"><!----> <a href="/site/favorite/" class="nav-link">❤️本站收藏</a></li><li class="dropdown-item"><!----> <a href="/site/friend/" class="nav-link">🔗友情链接</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpg"> <div class="blogger-info"><h3>sumcai's blog</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">🏠首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📚笔记" class="dropdown-title"><a href="/site/note/" class="link-title">📚笔记</a> <span class="title" style="display:none;">📚笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/opengl/" class="nav-link">OpenGL技术</a></li><li class="dropdown-item"><!----> <a href="/vulkan/" class="nav-link">Vulkan技术</a></li><li class="dropdown-item"><!----> <a href="/physics/" class="nav-link">物理引擎技术</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖教程" class="dropdown-title"><a href="/site/tutorial/" class="link-title">📖教程</a> <span class="title" style="display:none;">📖教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/site/tutorial/learnopengl/" class="nav-link">OpenGL中文教程</a></li></ul></div></div><div class="nav-item"><a href="/site/tips/" class="nav-link">✏️碎片</a></div><div class="nav-item"><a href="/site/msgboard/" class="nav-link">📋留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🧭导航" class="dropdown-title"><a href="/archives/" class="link-title">🧭导航</a> <span class="title" style="display:none;">🧭导航</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">📂分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">🔖标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">⌚时间线</a></li><li class="dropdown-item"><!----> <a href="/site/favorite/" class="nav-link">❤️本站收藏</a></li><li class="dropdown-item"><!----> <a href="/site/friend/" class="nav-link">🔗友情链接</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数学相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工具使用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>建站</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>日常工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/e20302/" class="sidebar-link">Git常用命令</a></li><li><a href="/pages/91f115/" class="sidebar-link">Markdown语法</a></li><li><a href="/pages/86191a/" aria-current="page" class="active sidebar-link">Cmake 详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/86191a/#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/86191a/#cmake-是什么" class="sidebar-link">cmake 是什么</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#为什么选用-cmake" class="sidebar-link">为什么选用 cmake</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#安装-cmake" class="sidebar-link">安装 cmake</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#基本语法" class="sidebar-link">基本语法</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/86191a/#hello-cmake-例子" class="sidebar-link">hello cmake 例子</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/86191a/#内部构建" class="sidebar-link">内部构建</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#外部构建" class="sidebar-link">外部构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/86191a/#从-hello-cmake-到项目" class="sidebar-link">从 hello cmake 到项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/86191a/#多个源代码文件" class="sidebar-link">多个源代码文件</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#将-mod1-模块作为动态库" class="sidebar-link">将 mod1 模块作为动态库</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#mod1-依赖静态库-mod2" class="sidebar-link">mod1 依赖静态库 mod2</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#如何支持-make-install-操作" class="sidebar-link">如何支持 make install 操作</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#添加一个-find-模块" class="sidebar-link">添加一个 Find 模块</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#传递给源代码一些配置" class="sidebar-link">传递给源代码一些配置</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#区分-开发版-与-发布版" class="sidebar-link">区分 开发版 与 发布版</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#总结-one-project-项目" class="sidebar-link">总结 ONE_PROJECT 项目</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/86191a/#指令参考" class="sidebar-link">指令参考</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#变量参考" class="sidebar-link">变量参考</a></li><li class="sidebar-sub-header"><a href="/pages/86191a/#其他参考" class="sidebar-link">其他参考</a></li></ul></li><li><a href="/pages/12fc61/" class="sidebar-link">GitHub自动同步到Gitee</a></li><li><a href="/pages/e9b76d/" class="sidebar-link">Clion开发环境配置</a></li><li><a href="/pages/4a9a26/" class="sidebar-link">VSCode开发换配置</a></li><li><a href="/pages/240da6/" class="sidebar-link">发布npm包</a></li><li><a href="/pages/c4ef20/" class="sidebar-link">zotero+bookxnote</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>PhotoShop</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><!----> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAGPklEQVRoQ+2Yf2xdZRnHv9/nPee0HXQE1q1m7e2QdVs7Jmp0MUowjAAJIYogxoDGBP7ABENUhKjgPxhMMKIhMUQw/OEfasKiidM/MFGjUUgYIcZo3e1k/Lq3TBgJc21t13PO+zzmnPXe3t7e257Std1Mz3/3nvd9nufzfJ/3ed/zEuf5w/M8fmwArLeCGwpsKLDCDPz/l1C5D7vNBTvgORGlyeRUB964ooKTK0lcuQ9bohTbYxd0I7BLEPuR4Tfx2ruxuagCR/vRpxLeWDNM1SkT2WSmJ1L6v7+vglcJWBHHBvBIP3YK3PshskUTnZJQNmVz1TSNqv5nu4CZIrYax7QFqPaja1wxJEG4vzbBVD1FXO23Qk9C/R8uH8M7izke2Yr3uE53AJTu2jhnGntKVPvtp5NfX9SBU6UxTC8HYgFAlqnyQHCtpJjySKcWA8gcZVCA//PeMbzUyvFIHz7g6PZDZJ6vLOtCCerJYfIbZ8FOr7Z1eMz/qqiyCwD+sQ29QWd4E1P7ZwsApYjkTr0nIX1q+iaFSZj4Q4Nv4UQjxJF+7KKEB1qBmeqcrSwRswAK7nX/Tf5im4Ke3dX0OQK6mCILAbajFAThDS0BvE7TSZeZ7xW6+wF2m1kK2KskUyb+sT3/1h9nDkd70O273GcaszwvkEQN4ZwqLk7eUBc8BNrFEHdZNpZmP9lTTe44ewCm46RshtmtpFxXlx+aEBLmJWU66Uy/nYr8jeB72znXVBMJJKTqR0C5GcDFILOSHKfI5tq8dDru3vc2JtvZWZYC8P5SCDfD+EGKfGy2lGKIRJnzxsfMXpMk+Z5GYdrKeRAngQ+DB0Dpmz9PE/JMMrInSOOBxAWfFeL5PZX02WZbhQHobcCEDwj0oBpLNQDzfpLOXdgyQ2oTJriv+Z34ZItJVi5zgdbVNE3ZsLjPAERPgbZ/qJL0NK+J4gDAxwF+Dt7/1MjLagBM/bgFri55c7Bm+leQT9b+Z5IIXPADiHS1WdzzWnUNgMT1gnjn7gpeaZxXGACGq0neRvNPm7EXIlfnhsyyjYzNJTSXUQORPGoM8zZLw9dB5ou0JYDZFMl8g5sroeipDMBZPLiripdXBADoL6DoqQPkEDoDSkfboNQqEHxH4iSwMHy8HewZU/4dirtkVQFMsb2+iLOsen/CnNu2SFan1fQuqh2QILiz3TiYQVQn1Ln6jt1YQmdNgWYA8z6mSAg2taLZSM1sGsRX8pYpri0ATU8Z5aJGwDUByB2m/gScbGtVHoUAzJReJ5sbwtoB5OvZv0W63oWdaAkFzECPsgUcbp67pgB5l/FaNuFwoxKLKWBmJupfNxdc2mptrDlA3km8HYPYAGePyy0Bsu5rdlLNInHugnYLe10A6sF4fRs0AjJtgoeRJlcwCD5vZqep2ISGbnNuAtSjsrIBj5nZgFAebNtGW7xYXwXWE0BgR9xM+q+kI/xUHsfsUSLbiZv3gaUzug4KGPR0l/iD4zF2hOKuIuWa7Cx0zgO8sg29M53hTVlWFfqfaNL/liE60yh8BOQd5zxAFni5FFwPMu/L3jSOTMqediUp34fZk4DtA+XKpUunNmINS6jmMvu4d1048wEPQHzwBYg8QtOvqWXfA/zScgBg+g1PdDi4g4XnmfmOiaTndHf0dOHjdDvjR0vh3UY+DrMfAcnDQHQYRH+RYNTs2b3V5KryQPghgi8WmZP3DdMHh6rpd0dLUZnErkKn0QIASuinvfjDouEhkPWLr3ZzDfb74UpyXVGA7KaDwD1D1eSJ0VL4BMgvZrZXBDBaCj8M4IX8yGymRvvWUCV99Gh/8FWQ94HcenYA7I8G3N85nrw80x39HMQNs238+J5qvIPAvEuCZd1OlwfcJ2hyb3Z7lxkl+UKQxj+00zjlLwjuAfjlViAG/HK4Et96rB+DqUQLbvAMeJ2wQ4AdHKqkzx0pRfsE9k0D8hsLguOBxfcOjuFYc5KWBbBU7RoQjpaCa0DeAsPtJC8EbMLUPjk8lv4p73AD4e8IXjub1WfE7KHdY8nhpWy3e39WARqdZDDHtof7Bo8nIwSS2rsRIOroDz7qmb40VMXxdxt4bd6qAaw0sKLzNwCKZmq1xm0osFqZLWp3Q4GimVqtcee9Av8DAnkTbS4epvYAAAAASUVORK5CYII=">
          Cmake 详解
        </h1>  <div class="theme-vdoing-content content__default"><h1 id="cmake-详解"><a href="#cmake-详解" class="header-anchor">#</a> Cmake 详解</h1> <p>本文记录了<code>cmake</code>的用法。</p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <h3 id="cmake-是什么"><a href="#cmake-是什么" class="header-anchor">#</a> cmake 是什么</h3> <p><code>cmake</code>是一款优秀的工程构建工具。KDE 开发者在使用了近 10 年<code>autotools</code>之后，终于决定为<code>KDE4</code>选择一个新的工程构建工具。</p> <p>特点:</p> <ul><li>开放源代码</li> <li>跨平台，在<code>Linux/Unix</code>上，生成<code>makefile</code>；在<code>MacOS</code>上生成<code>xcode</code>；在<code>windows</code>上生成<code>MSVC</code>的工程文件</li> <li>简化编译构建过程和编译过程，工具链简单<code>cmake + make</code></li> <li>高效，比<code>autotools</code>快<code>%40</code>,主要是因为在工具链中没有<code>libtool</code></li> <li>可拓展，可以为<code>cmake</code>编写特定功能的模块，扩充<code>cmake</code>功能</li> <li>额外的构建目录树（采用外部构建），不用担心任何删除源码文件的风险</li> <li>支持机器字节序以及其他硬件特性问题的测试</li> <li>在大部分平台下支持并行构建和自动生成文件依赖</li></ul> <h3 id="为什么选用-cmake"><a href="#为什么选用-cmake" class="header-anchor">#</a> 为什么选用 cmake</h3> <p>为什么不用<code>autotools</code>?</p> <ul><li><code>autotools</code>在<code>windows</code>平台不友好</li> <li>工具链太长，需要用户操作的地方太多</li></ul> <p>为什么不采用<code>JAM</code>、<code>qmake</code>、<code>Scons</code> 和 <code>ANT</code>？</p> <ul><li><code>qmake</code>是与<code>cmake</code>最相似的，尽管它缺少一些<code>CMake</code>中提供的一些系统适配的功能</li> <li><code>ANT</code>使用<code>xml</code>作为输入使其与传统的<code>makefile</code>区分开来</li> <li><code>JAM</code>用他自有的语言</li> <li><code>Scons</code>使用的是<code>python</code></li> <li>这些工具中的几个直接调用编译器，而不是构建系统来直接处理这些构建任务。它们中的一些工具要求安装例如<code>python</code>和<code>Java</code>的第三方工具才能够正常工作。</li></ul> <h3 id="安装-cmake"><a href="#安装-cmake" class="header-anchor">#</a> 安装 cmake</h3> <p>直接去官网下载最新的源代码，然后执行:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./bootstrap --prefix<span class="token operator">=</span>/usr/local
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="基本语法"><a href="#基本语法" class="header-anchor">#</a> 基本语法</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>command<span class="token punctuation">(</span>arg1 arg2 <span class="token punctuation">..</span>.<span class="token punctuation">)</span>          <span class="token comment"># 运行命令</span>
set<span class="token punctuation">(</span>var_name var_value<span class="token punctuation">)</span>         <span class="token comment"># 定义变量,或者给已经存在的变量赋值</span>
command<span class="token punctuation">(</span>arg1 <span class="token variable">${var_name}</span><span class="token punctuation">)</span>       <span class="token comment"># 使用变量</span>

<span class="token comment"># 控制语句</span>
IF<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>
    COMMAND1<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span>
ELSE<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>
    COMMAND2<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span>
ENDIF<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>

<span class="token comment"># expression</span>
IF<span class="token punctuation">(</span>var<span class="token punctuation">)</span>                       <span class="token comment"># 不是空, 0, N, NO, OFF, FALSE, NOTFOUND 或 &lt;var&gt;_NOTFOUND时，为真</span>
IF<span class="token punctuation">(</span>NOT var<span class="token punctuation">)</span>                   <span class="token comment"># 与上述条件相反。</span>
IF<span class="token punctuation">(</span>var1 AND var2<span class="token punctuation">)</span>             <span class="token comment"># 当两个变量都为真是为真。</span>
IF<span class="token punctuation">(</span>var1 OR var2<span class="token punctuation">)</span>              <span class="token comment"># 当两个变量其中一个为真时为真。</span>
IF<span class="token punctuation">(</span>COMMAND cmd<span class="token punctuation">)</span>               <span class="token comment"># 当给定的cmd确实是命令并可以调用是为真</span>
IF<span class="token punctuation">(</span>EXISTS <span class="token function">dir</span><span class="token punctuation">)</span>                <span class="token comment"># 目录名存在</span>
IF<span class="token punctuation">(</span>EXISTS <span class="token function">file</span><span class="token punctuation">)</span>               <span class="token comment"># 文件名存在</span>
IF<span class="token punctuation">(</span>IS_DIRECTORY <span class="token function">dirname</span><span class="token punctuation">)</span>      <span class="token comment"># 当dirname是目录</span>
IF<span class="token punctuation">(</span>file1 IS_NEWER_THAN file2<span class="token punctuation">)</span> <span class="token comment"># 当file1比file2新,为真</span>
IF<span class="token punctuation">(</span>variable MATCHES regex<span class="token punctuation">)</span>    <span class="token comment"># 符合正则</span>

<span class="token comment"># 循环</span>
WHILE<span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
    COMMAND1<span class="token punctuation">(</span>ARGS<span class="token punctuation">)</span>
    // <span class="token punctuation">..</span>.
ENDWHILE<span class="token punctuation">(</span>condition<span class="token punctuation">)</span>

AUX_SOURCE_DIRECTORY<span class="token punctuation">(</span>. SRC_LIST<span class="token punctuation">)</span>
FOREACH<span class="token punctuation">(</span>one_dir <span class="token variable">${SRC_LIST}</span><span class="token punctuation">)</span>
    MESSAGE<span class="token punctuation">(</span><span class="token variable">${one_dir}</span><span class="token punctuation">)</span>
ENDFOREACH<span class="token punctuation">(</span>onedir<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>在项目的每个目录中，都需要编写一个<code>CMakeLists.txt</code>。</p> <h2 id="hello-cmake-例子"><a href="#hello-cmake-例子" class="header-anchor">#</a> hello cmake 例子</h2> <p>准备好下面两个文件。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// cmake-demo/main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello cmake!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// cmake-demo/CMakeLists.txt</span>
<span class="token function">PROJECT</span><span class="token punctuation">(</span>HELLO<span class="token punctuation">)</span>
<span class="token function">SET</span><span class="token punctuation">(</span>SRC_LIST main<span class="token punctuation">.</span>c<span class="token punctuation">)</span>
<span class="token function">ADD_EXECUTABLE</span><span class="token punctuation">(</span>main $<span class="token punctuation">{</span>SRC_LIST<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="内部构建"><a href="#内部构建" class="header-anchor">#</a> 内部构建</h3> <p>在<code>cmake-demo</code>目录下执行:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cmake <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就可以看到<code>cmake</code>为项目生产的<code>Makefile</code>文件，以及一些<code>cmake</code>缓存文件。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="外部构建"><a href="#外部构建" class="header-anchor">#</a> 外部构建</h3> <p>内部构建生成的<code>Cmake</code>的中间文件与源代码文件混杂在一起，并且<code>cmake</code>没有提供清理这些中间文件的命令。</p> <p>所以<code>cmake</code>推荐使用外部构建，步骤如下:</p> <ol><li>在<code>CMakeLists.txt</code>的同级目录下，新建一个<code>build</code>文件夹</li> <li>进入<code>build</code>文件夹，执行<code>cmake ..</code>命令，这样所有的中间文件以及<code>Makefile</code>都在<code>build</code>目录下了</li> <li>在<code>build</code>目录下执行<code>make</code>就可以得到可执行文件</li></ol> <h2 id="从-hello-cmake-到项目"><a href="#从-hello-cmake-到项目" class="header-anchor">#</a> 从 hello cmake 到项目</h2> <h3 id="多个源代码文件"><a href="#多个源代码文件" class="header-anchor">#</a> 多个源代码文件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build                   <span class="token comment"># 构建目录</span>
├── CMakeLists.txt          <span class="token comment"># 主CMakeLists.txt</span>
├── main.c                  <span class="token comment"># 入口源文件</span>
└── mod1                    <span class="token comment"># 模块1</span>
    ├── mod1.c
    ├── mod1_func.c
    ├── mod1_func.h
    └── mod1.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// main.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1/mod1.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mod1_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// mod1.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__MOD1_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__MOD1_H__</span></span>
<span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> GLOBAL_MOD1_VAR<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">mod1_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">// mod1.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1_func.h&quot;</span></span>
<span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> GLOBAL_MOD1_VAR <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">mod1_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mod1_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// mod1_func.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__MOD1_FUNC_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__MOD1_FUNC_H__</span></span>
<span class="token keyword">void</span> <span class="token function">mod1_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">// mod1_func.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1_func.h&quot;</span></span>
<span class="token keyword">void</span> <span class="token function">mod1_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot;mod1: %d \n&quot;</span><span class="token punctuation">,</span> GLOBAL_MOD1_VAR <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>本项目只有一个入口<code>main.c</code>文件，然后就是多个模块的源代码文件。一个主<code>CMakeLists.txt</code>也可管理好:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>
PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>
add_executable<span class="token punctuation">(</span>main main.c mod1/mod1.c mod1/mod1_func.c<span class="token punctuation">)</span> <span class="token comment"># 指明需要的源代码文件就好</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="将-mod1-模块作为动态库"><a href="#将-mod1-模块作为动态库" class="header-anchor">#</a> 将 mod1 模块作为动态库</h3> <p>对于上述文件，如果想让<code>mod1</code>独立编译，然后再链接进入可执行文件。则需要做出的修改如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── CMakeLists.txt          <span class="token comment"># 修改</span>
├── main.c
└── mod1
    ├── CMakeLists.txt      <span class="token comment"># 新增</span>
    ├── mod1.c
    ├── mod1_func.c
    ├── mod1_func.h
    └── mod1.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./CMakeLists.txt</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>
PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>
add_subdirectory<span class="token punctuation">(</span>mod1 lib<span class="token punctuation">)</span>          <span class="token comment"># 添加一个模块，并且将编译好库文件放置在 build/lib 目录</span>
add_executable<span class="token punctuation">(</span>main main.c<span class="token punctuation">)</span>
target_link_libraries<span class="token punctuation">(</span>main mod1<span class="token punctuation">)</span>    <span class="token comment"># 链接 mod1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./mod1/CMakeLists.txt</span>
add_library<span class="token punctuation">(</span>mod1 SHARED mod1.c mod1_func.c<span class="token punctuation">)</span> <span class="token comment"># 生成动态库 libmod1.so</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="mod1-依赖静态库-mod2"><a href="#mod1-依赖静态库-mod2" class="header-anchor">#</a> mod1 依赖静态库 mod2</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── CMakeLists.txt
├── main.c
└── mod1
    ├── CMakeLists.txt          <span class="token comment"># 修改</span>
    ├── mod1.c
    ├── mod1_func.c             <span class="token comment"># 修改，里面用到了 mod2 中的函数</span>
    ├── mod1_func.h
    ├── mod1.h
    └── mod2                    <span class="token comment"># 新增</span>
        ├── CMakeLists.txt
        ├── mod2.c
        └── mod2.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>代码改动:</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// ./mod1/mod1_func.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1_func.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod2/mod2.h&quot;</span>          <span class="token comment">// 新增</span></span>
<span class="token keyword">void</span> <span class="token function">mod1_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mod2_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 新增</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">&quot;mod1: %d \n&quot;</span><span class="token punctuation">,</span> GLOBAL_MOD1_VAR <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// ./mod1/mod2/mod2.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__MOD2_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__MOD2_H__</span></span>
<span class="token keyword">void</span> <span class="token function">mod2_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">// ./mod1/mod2/mod2.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod2.h&quot;</span></span>
<span class="token keyword">void</span> <span class="token function">mod2_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">&quot;call mod2 func\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>main.c</code>没有直接用到<code>mod2</code>的，所以主<code>CMakeLists.txt</code>保持不变。<code>mod1</code>依赖<code>mod2</code>，所以由<code>mod1</code>的<code>CMakeLists.txt</code>负责<code>mod2</code>模块。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mod1/CMakeLists.txt</span>
add_subdirectory<span class="token punctuation">(</span>mod2 mo2_lib<span class="token punctuation">)</span>  <span class="token comment"># 新增 mod2 模块,　编译好的库置于 build/lib/mod2_lib　中</span>
link_directories<span class="token punctuation">(</span>mod2_lib<span class="token punctuation">)</span>      <span class="token comment"># 添加链接器的查找路径 build/lib/mod2_lib</span>
add_library<span class="token punctuation">(</span>mod1 SHARED mod1.c mod1_func.c<span class="token punctuation">)</span> <span class="token comment"># 生成动态库 libmod1.so</span>
target_link_libraries<span class="token punctuation">(</span>mod1 mod2<span class="token punctuation">)</span> <span class="token comment"># 将 libmod2.a 链接进入 libmod1.so 中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># mod1/mod2/CMakeLists.txt</span>
add_library<span class="token punctuation">(</span>mod2 STATIC mod2.c<span class="token punctuation">)</span> <span class="token comment"># 生成静态库 libmod2.a</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>思考下下列 4 种依赖关系:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>main -<span class="token operator">&gt;</span> libmod1.so -<span class="token operator">&gt;</span> libmod2.a
main -<span class="token operator">&gt;</span> libmod1.a  -<span class="token operator">&gt;</span> libmod2.a
main -<span class="token operator">&gt;</span> libmod1.so -<span class="token operator">&gt;</span> libmod2.so
main -<span class="token operator">&gt;</span> libmod1.a  -<span class="token operator">&gt;</span> libmod2.so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>对于底层是<code>libmod2.a</code>的情况，所有的实现代码都已经打包进入<code>libmod1</code>中，所以<code>libmod2.a</code>在最终生成<code>main</code>后，可以删除</li> <li>对于底层是<code>libmod2.so</code>的情况，打包进入<code>libmod1</code>中的全部都是符号表，所以要保证<code>libmod2.so</code>的存在，并且正确链接到<code>main</code>了</li></ul> <h3 id="如何支持-make-install-操作"><a href="#如何支持-make-install-操作" class="header-anchor">#</a> 如何支持 make install 操作</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── CMakeLists.txt          <span class="token comment"># 修改</span>
├── doc                     <span class="token comment"># 新增</span>
│   └── release_note.txt
├── main.c
└── mod1
    ├── CMakeLists.txt      <span class="token comment"># 修改</span>
    ├── mod1.c
    ├── mod1_func.c
    ├── mod1_func.h
    ├── mod1.h
    └── mod2
        ├── CMakeLists.txt  <span class="token comment"># 修改</span>
        ├── mod2.c
        └── mod2.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>各个目录的<code>CMakeLists.txt</code>各自负责自己目录下要安装的文件:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./CMakeLists.txt</span>
cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>
PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>
add_subdirectory<span class="token punctuation">(</span>mod1 lib<span class="token punctuation">)</span>          <span class="token comment"># 添加一个模块，并且将编译好库文件放置在 build/lib 目录</span>
add_executable<span class="token punctuation">(</span>main main.c<span class="token punctuation">)</span>
target_link_libraries<span class="token punctuation">(</span>main mod1<span class="token punctuation">)</span>         <span class="token comment"># 链接 mod1</span>

set<span class="token punctuation">(</span>CMAKE_INSTALL_PREFIX <span class="token variable">$ENV</span><span class="token punctuation">{</span><span class="token environment constant">HOME</span><span class="token punctuation">}</span>/usr<span class="token punctuation">)</span>              <span class="token comment"># 安装路径前缀 /home/cao/usr</span>
install<span class="token punctuation">(</span>DIRECTORY doc/ DESTINATION share/PROJECT_ONE<span class="token punctuation">)</span> <span class="token comment"># 安装项目文档</span>
install<span class="token punctuation">(</span>TARGETS main RUNTIME DESTINATION bin <span class="token punctuation">)</span>        <span class="token comment"># main 安装到 usr/bin</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./mod1/CMakeLists.txt</span>
add_subdirectory<span class="token punctuation">(</span>mod2 mo2_lib<span class="token punctuation">)</span>  <span class="token comment"># 新增 mod2 模块,　编译好的库置于 build/lib/mod2_lib　中</span>
link_directories<span class="token punctuation">(</span>mod2_lib<span class="token punctuation">)</span>      <span class="token comment"># 添加链接器的查找路径 build/lib/mod2_lib</span>
add_library<span class="token punctuation">(</span>mod1 SHARED mod1.c mod1_func.c<span class="token punctuation">)</span> <span class="token comment"># 生成动态库 libmod1.so</span>
target_link_libraries<span class="token punctuation">(</span>mod1 mod2<span class="token punctuation">)</span> <span class="token comment"># 将 libmod2.a 链接进入 libmod1.so 中</span>

install<span class="token punctuation">(</span>TARGETS mod1 LIBRARY DESTINATION lib<span class="token punctuation">)</span>  <span class="token comment"># 安装到 usr/lib</span>
install<span class="token punctuation">(</span>FILES mod1.h DESTINATION include/mod1<span class="token punctuation">)</span> <span class="token comment"># 安装到 usr/include/mod1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./mod1/mod2/CMakeLists.txt</span>
add_library<span class="token punctuation">(</span>mod2 SHARED mod2.c<span class="token punctuation">)</span> <span class="token comment"># 生成静态库 libmod2.a</span>
install<span class="token punctuation">(</span>TARGETS mod2 LIBRARY DESTINATION lib<span class="token punctuation">)</span>  <span class="token comment"># 安装到 usr/lib</span>
install<span class="token punctuation">(</span>FILES mod2.h DESTINATION include/mod2<span class="token punctuation">)</span> <span class="token comment"># 安装到 usr/include/mod2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="添加一个-find-模块"><a href="#添加一个-find-模块" class="header-anchor">#</a> 添加一个 Find 模块</h3> <p>其实纯粹依靠<code>cmake</code>本身提供的基本指令来管理工程是一件非常复杂的事情，所以<code>cmake</code>设计成了可扩展的架构，可以通过编写一些通用的模块来扩展<code>cmake</code>。这便是<code>Finder</code>功能，对于<code>linux</code>里一些常用的内置库，<code>cmake</code>也预先提供了这样模块，比如<code>FindCURL</code>、<code>FindCurses</code>、<code>FindImageMagick</code>模块。在<code>CMakeLists.txt</code>里的使用如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>find_package<span class="token punctuation">(</span>CURL<span class="token punctuation">)</span>
if<span class="token punctuation">(</span>CURL_FOUND<span class="token punctuation">)</span>
    include_directories<span class="token punctuation">(</span><span class="token variable">${CURL_INCLUDE_DIR}</span><span class="token punctuation">)</span>
    add_executable<span class="token punctuation">(</span>curltest main.c<span class="token punctuation">)</span>
    target_link_libraries<span class="token punctuation">(</span>curltest <span class="token variable">${CURL_LIBRARY}</span><span class="token punctuation">)</span>
else<span class="token punctuation">(</span>CURL_FOUND<span class="token punctuation">)</span>
    message<span class="token punctuation">(</span>FATAL_ERROR <span class="token string">&quot;curl library not found&quot;</span><span class="token punctuation">)</span>
endif<span class="token punctuation">(</span>CURL_FOUND<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>那么对于<code>cmake</code>没有提供<code>Find</code>模块的第三方库，我们该如何实现这一功能呢？下面以<code>hiredis</code>库（一个流行的操作<code>Redis</code>的<code>C</code>库）举例。</p> <p>首先，我们先安装好它:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/redis/hiredis/archive/v0.14.0.tar.gz <span class="token comment"># 下载最新发布版</span>
<span class="token function">tar</span> -zxvf v0.14.0.tar.gz                                     <span class="token comment"># 解压</span>
<span class="token builtin class-name">cd</span> hiredis-0.14.0
<span class="token function">make</span>                                                         <span class="token comment"># 编译，在本目录下得到 libhiredis.so</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># 执行结果</span>
<span class="token function">mkdir</span> -p /usr/local/include/hiredis /usr/local/include/hiredis/adapters /usr/local/lib
<span class="token function">cp</span> -pPR hiredis.h async.h read.h sds.h /usr/local/include/hiredis
<span class="token function">cp</span> -pPR adapters/*.h /usr/local/include/hiredis/adapters
<span class="token function">cp</span> -pPR libhiredis.so /usr/local/lib/libhiredis.so.0.14
<span class="token builtin class-name">cd</span> /usr/local/lib <span class="token operator">&amp;&amp;</span> <span class="token function">ln</span> -sf libhiredis.so.0.14 libhiredis.so
<span class="token function">cp</span> -pPR libhiredis.a /usr/local/lib
<span class="token function">mkdir</span> -p /usr/local/lib/pkgconfig
<span class="token function">cp</span> -pPR hiredis.pc /usr/local/lib/pkgconfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>从上面的安装结果来看:</p> <ul><li>头文件在<code>/usr/local/include/hiredis/hiredis.h</code>,所以程序里需要<code>#include &lt;hiredis/hiredis.h&gt;</code></li> <li>库文件在<code>/usr/local/lib</code>中,库名为<code>hiredis</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── cmake                   <span class="token comment"># 新增</span>
│   └── FindHIREDIS.cmake   <span class="token comment"># FindHIREDIS 模块</span>
├── CMakeLists.txt          <span class="token comment"># 修改</span>
├── doc
│   └── release_note.txt
├── main.c                  <span class="token comment"># 修改</span>
└── mod1
    ├── CMakeLists.txt
    ├── mod1.c
    ├── mod1_func.c
    ├── mod1_func.h
    ├── mod1.h
    └── mod2
        ├── CMakeLists.txt
        ├── mod2.c
        └── mod2.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>源代码的修改,添加使用例子 :</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;hiredis/hiredis.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1/mod1.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mod1_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redisContext <span class="token operator">*</span>conn <span class="token operator">=</span> <span class="token function">redisConnect</span><span class="token punctuation">(</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> conn <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> conn<span class="token operator">-&gt;</span>err <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;连接失败:%s\n&quot;</span><span class="token punctuation">,</span> conn<span class="token operator">-&gt;</span>errstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    redisReply <span class="token operator">*</span>reply <span class="token operator">=</span> <span class="token punctuation">(</span>redisReply<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">redisCommand</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">&quot;set foo 1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">freeReplyObject</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>

    reply <span class="token operator">=</span> <span class="token function">redisCommand</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">&quot;get foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span>reply<span class="token operator">-&gt;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">freeReplyObject</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">redisFree</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>自定义<code>FindHIREDIS</code>模块:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>find_path<span class="token punctuation">(</span>HIREDIS_INCLUDE_DIR hiredis.h /usr/local/include/hiredis<span class="token punctuation">)</span>
find_library<span class="token punctuation">(</span>HIREDIS_LIBRARY NAMES hiredis <span class="token environment constant">PATH</span> /usr/local/lib<span class="token punctuation">)</span>

if<span class="token punctuation">(</span>HIREDIS_INCLUDE_DIR AND HIREDIS_LIBRARY<span class="token punctuation">)</span>
    SET<span class="token punctuation">(</span>HIREDIS_FOUND TRUE<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span>HIREDIS_INCLUDE_DIR AND HIREDIS_LIBRARY<span class="token punctuation">)</span>

if<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>
    if<span class="token punctuation">(</span>NOT HIREDIS_FIND_QUIETLY<span class="token punctuation">)</span>
        message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;Found Hello: <span class="token variable">${HIREDIS_LIBRARY}</span>&quot;</span><span class="token punctuation">)</span>
    endif<span class="token punctuation">(</span>NOT HIREDIS_FIND_QUIETLY<span class="token punctuation">)</span>
else<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>
    if<span class="token punctuation">(</span>HIREDIS_FIND_REQUIRED<span class="token punctuation">)</span>
        message<span class="token punctuation">(</span>FATAL_ERROR <span class="token string">&quot;Could not find hello library&quot;</span><span class="token punctuation">)</span>
    endif<span class="token punctuation">(</span>HIREDIS_FIND_REQUIRED<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>修改主<code>CMakeLists.txt</code>为:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>
PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>
add_subdirectory<span class="token punctuation">(</span>mod1 lib<span class="token punctuation">)</span>
add_executable<span class="token punctuation">(</span>main main.c<span class="token punctuation">)</span>
target_link_libraries<span class="token punctuation">(</span>main mod1<span class="token punctuation">)</span>

set<span class="token punctuation">(</span>CMAKE_MODULE_PATH <span class="token variable">${PROJECT_SOURCE_DIR}</span>/cmake<span class="token punctuation">)</span>    <span class="token comment"># 设置自定义 Find module 的路径</span>
<span class="token comment"># 连接 libhiredis.so</span>
find_package<span class="token punctuation">(</span>HIREDIS<span class="token punctuation">)</span>
if<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>
    include_directories<span class="token punctuation">(</span><span class="token variable">${HIREDIS_INCLUDE_DIR}</span><span class="token punctuation">)</span>
    target_link_libraries<span class="token punctuation">(</span>main <span class="token variable">${HIREDIS_LIBRARY}</span><span class="token punctuation">)</span>
else<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>
    message<span class="token punctuation">(</span>FATAL_ERROR <span class="token string">&quot;libhiredis.so not be found!&quot;</span><span class="token punctuation">)</span>
endif<span class="token punctuation">(</span>HIREDIS_FOUND<span class="token punctuation">)</span>

set<span class="token punctuation">(</span>CMAKE_INSTALL_PREFIX <span class="token variable">$ENV</span><span class="token punctuation">{</span><span class="token environment constant">HOME</span><span class="token punctuation">}</span>/usr<span class="token punctuation">)</span>
install<span class="token punctuation">(</span>DIRECTORY doc/ DESTINATION share/PROJECT_ONE<span class="token punctuation">)</span>
install<span class="token punctuation">(</span>TARGETS main RUNTIME DESTINATION bin<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="传递给源代码一些配置"><a href="#传递给源代码一些配置" class="header-anchor">#</a> 传递给源代码一些配置</h3> <p>在<code>CMakeLists.txt</code>中配置参数，控制源代码中代码的编译部分，比如可以通过一个参数控制，是用自己写的库还是系统库？</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── cmake
│   └── FindHIREDIS.cmake
├── cmakeconfig.h.in            <span class="token comment"># 新增</span>
├── CMakeLists.txt              <span class="token comment"># 修改</span>
├── doc
│   └── release_note.txt
├── main.c                      <span class="token comment"># 修改</span>
└── mod1
    ├── CMakeLists.txt
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在主<code>CMakeLists.txt</code>里定义:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>
PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>

<span class="token comment"># 通过 cmakeconfig.h 传递参数给源文件</span>
set<span class="token punctuation">(</span>AUTHOR <span class="token string">&quot;codekissyoung&quot;</span><span class="token punctuation">)</span>
set<span class="token punctuation">(</span>RELEASE_DATE <span class="token string">&quot;2019-6-25&quot;</span><span class="token punctuation">)</span>
set<span class="token punctuation">(</span>USE_MY_LIB <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>                                  <span class="token comment"># 使用自己的库</span>
configure_file<span class="token punctuation">(</span>
    <span class="token variable">${PROJECT_SOURCE_DIR}</span>/cmakeconfig.h.in
    <span class="token variable">${PROJECT_BINARY_DIR}</span>/cmakeconfig.h
<span class="token punctuation">)</span>
include_directories<span class="token punctuation">(</span><span class="token variable">${PROJECT_BINARY_DIR}</span><span class="token punctuation">)</span>

add_subdirectory<span class="token punctuation">(</span>mod1 lib<span class="token punctuation">)</span>                            <span class="token comment"># 添加模块，编译后放在 build/lib</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>再定义<code>cmakeconfig.h.in</code>,它会在<code>Build</code>目录里生成一个<code>cmakeconfig.h</code>，<code>@@</code>中间的名字会被替换:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#define AUTHOR &quot;@AUTHOR@&quot;</span>
<span class="token comment">#define RELEASE_DATE &quot;@RELEASE_DATE@&quot;</span>
<span class="token comment">#define USE_MY_LIB &quot;@USE_MY_LIB@&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>再看下源代码中如何使用:</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;hiredis/hiredis.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;cmakeconfig.h&quot;</span>                    <span class="token expression"># 这里引用 cmakeconfig<span class="token punctuation">.</span>h</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;mod1/mod1.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;author: %s, release_date: %s\n&quot;</span><span class="token punctuation">,</span> AUTHOR<span class="token punctuation">,</span> RELEASE_DATE <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">USE_MY_LIB</span></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;使用自己的库的代码\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;使用系统库的代码\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token function">mod1_process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="区分-开发版-与-发布版"><a href="#区分-开发版-与-发布版" class="header-anchor">#</a> 区分 开发版 与 发布版</h3> <p>上述的代码编译后都是不可调试的，并且没有做编译优化，我们希望能够编译成一个调试版本与一个发布版本。做法如下:</p> <ul><li>我们将<code>build</code>目录作为开发版本编译目录，与之相对的新建一个<code>release</code>目录作为发布版本</li> <li>在<code>build</code>目录下我们执行<code>cmake -DMAKE_BUILD_TYPE=Debug ..</code>,编译命令会使用<code>-g</code></li> <li>在<code>release</code>目录下我们执行<code>cmake -DMAKE_BUILD_TYPE=Release ..</code>,编译命令会使用<code>-O3 -DNDEBUG</code></li></ul> <p>所以，在源代码中，我们可以使用<code>NDEBUG</code>宏来控制，在开发版输出调试信息，而在发布版本去掉调试信息。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">NDEBUG</span></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;author: %s, release_date: %s\n&quot;</span><span class="token punctuation">,</span> AUTHOR<span class="token punctuation">,</span> RELEASE_DATE <span class="token punctuation">)</span><span class="token punctuation">;</span> # 只在开发版本编译
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我自己在写代码的时候，习惯在开发版本打开所有的错误报告，而上述的开发版本只使用了<code>-g</code>，这显然是不够的，需要通过在<code>CMakeLists.txt</code>里重新设置下开发版本的编译参数:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>

PROJECT<span class="token punctuation">(</span>PROJECT_ONE<span class="token punctuation">)</span>

set<span class="token punctuation">(</span>CMAKE_C_FLAGS_DEBUG <span class="token string">&quot;-g -Wall -pedantic -DDEBUG&quot;</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;debug flags: <span class="token variable">${CMAKE_C_FLAGS_DEBUG}</span>&quot;</span><span class="token punctuation">)</span>

message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;release flags: <span class="token variable">${CMAKE_C_FLAGS_RELEASE}</span>&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>通常我习惯使用脚本来完成重复的<code>构建-编译-运行</code>这一过程，参考如下:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./make-debug.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token function">rm</span> -rf build/*                                <span class="token comment"># 清理上一次的结果</span>

<span class="token builtin class-name">cd</span> build <span class="token operator">&amp;&amp;</span> cmake -DCMAKE_BUILD_TYPE<span class="token operator">=</span>debug <span class="token punctuation">..</span> <span class="token comment"># 进入debug目录，执行构建</span>

<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> ./main                                <span class="token comment"># 编译，然后运行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./make-release.sh
<span class="token comment">#!/bin/bash</span>
<span class="token function">rm</span> -rf release/*                                  <span class="token comment"># 清理上一次的结果</span>

<span class="token builtin class-name">cd</span> release <span class="token operator">&amp;&amp;</span> cmake -DCMAKE_BUILD_TYPE<span class="token operator">=</span>release <span class="token punctuation">..</span> <span class="token comment"># 进入release目录，执行构建</span>

<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> ./main                                    <span class="token comment"># 编译，然后运行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="总结-one-project-项目"><a href="#总结-one-project-项目" class="header-anchor">#</a> 总结 ONE_PROJECT 项目</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── build
├── cmake
│   └── FindHIREDIS.cmake
├── doc
│   └── release_note.txt
├── mod1
│   ├── mod2
│   │   ├── CMakeLists.txt
│   │   ├── mod2.c
│   │   └── mod2.h
│   ├── CMakeLists.txt
│   ├── mod1.c
│   ├── mod1_func.c
│   ├── mod1_func.h
│   └── mod1.h
├── release
├── cmakeconfig.h.in
├── CMakeLists.txt
├── main.c
├── make-debug.sh
└── make-release.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>整个项目的目录结构如上,把这个项目作为脚手架，进行开发的话，非常容易就实现下面目标:</p> <ul><li>非常容易划分，添加项目自己实现的<code>mod</code></li> <li>非常容易通过<code>Find</code>功能引入第三方库</li> <li>非常容易通过传递参数到 源代码 中，实现条件编译，比如选择使用　第三方库　还是 系统库　等</li> <li>开发版本 与 发布版本 分离</li></ul> <h2 id="指令参考"><a href="#指令参考" class="header-anchor">#</a> 指令参考</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>PROJECT<span class="token punctuation">(</span>projectname<span class="token punctuation">)</span> <span class="token comment"># 项目名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>SET<span class="token punctuation">(</span>VAR <span class="token punctuation">[</span>VALUE<span class="token punctuation">]</span> <span class="token punctuation">[</span>CACHE TYPE DOCSTRING <span class="token punctuation">[</span>FORCE<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>SET</code>定义变量。使用变量则是<code>${VAR_NAME}</code>。注意：如果是在<code>IF</code>控制语句中，不能使用<code>${}</code>，而是直接使用<code>VAR_NAME</code>。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>MESSAGE<span class="token punctuation">(</span><span class="token punctuation">[</span>SEND_ERROR <span class="token operator">|</span> STATUS <span class="token operator">|</span> FATAL_ERROR<span class="token punctuation">]</span> <span class="token string">&quot;message to display&quot;</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>MESSAGE</code>向终端输出用户定义的信息，<code>FATAL_ERROR</code>会立即终止<code>cmake</code>编译过程。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ADD_EXECUTABLE<span class="token punctuation">(</span>exe <span class="token variable">${SRC_LIST}</span><span class="token punctuation">)</span>                     <span class="token comment"># 生成可执行文件 exe</span>
ADD_LIBRARY<span class="token punctuation">(</span>mod <span class="token punctuation">[</span>SHARED<span class="token operator">|</span>STATIC<span class="token operator">|</span>MODULE<span class="token punctuation">]</span> <span class="token variable">${SRC_LIST}</span><span class="token punctuation">)</span> <span class="token comment"># 生成库 libmod.so</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ADD_SUBDIRECTORY<span class="token punctuation">(</span>source_dir <span class="token punctuation">[</span>binary_dir<span class="token punctuation">]</span> <span class="token punctuation">[</span>EXCLUDE_FROM_ALL<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>ADD_SUBDIRECTORY</code>指定<code>cmake</code>子目录源代码所在路径，以及编译后二进制文件存放目录。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$ENV</span><span class="token punctuation">{</span><span class="token environment constant">HOME</span><span class="token punctuation">}</span> <span class="token comment"># 使用环境变量 HOME</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>INCLUDE_DIRECTORIES<span class="token punctuation">(</span>header_file_dir<span class="token punctuation">)</span>        <span class="token comment"># 添加头文件搜索目录</span>
LINK_DIRECTORIES<span class="token punctuation">(</span>lib_file_dir<span class="token punctuation">)</span>　　　         <span class="token comment"># 添加库文件搜索目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>TARGET_LINK_LIBRARIES<span class="token punctuation">(</span>exe mod1<span class="token punctuation">)</span>             <span class="token comment"># 将 libmod1.so 链接到 exe 中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ADD_DEFINITIONS<span class="token punctuation">(</span>-DENABLE_DEBUG<span class="token punctuation">)</span>             <span class="token comment"># 向C/C++编译器中添加宏定义 ENABLE_DEBUG</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ADD_DEPENDENCIES<span class="token punctuation">(</span>target-name depend-target1 <span class="token punctuation">)</span> <span class="token comment"># 定义依赖</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>AUX_SOURCE_DIRECTORY<span class="token punctuation">(</span>. SRC_LIST<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>AUX_SOURCE_DIRECTORY</code>发现一个目录下所有的源代码文件并将列表存储在一个变量中。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>EXEC_PROGRAM<span class="token punctuation">(</span>ls ARGS <span class="token string">&quot;*.c&quot;</span> OUTPUT_VARIABLE LS_OUTPUT RETURN_VALUE LS_RVALUE<span class="token punctuation">)</span>
IF<span class="token punctuation">(</span>not LS_RVALUE<span class="token punctuation">)</span>
    MESSAGE<span class="token punctuation">(</span>STATUS <span class="token string">&quot;ls result: &quot;</span> <span class="token variable">${LS_OUTPUT}</span><span class="token punctuation">)</span>
ENDIF<span class="token punctuation">(</span>not LS_RVALUE<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>EXEC_PROGRAM</code>用于在构建时，运行<code>shell</code>命令，<code>ARGS</code>指明参数，<code>OUTPUT_VARIABLE</code> <code>LS_OUTPUT</code> <code>RETURN_VALUE</code> <code>LS_RVALUE</code> 存储了命令运行的结果。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>INCLUDE<span class="token punctuation">(</span>file1 <span class="token punctuation">[</span>OPTIONAL<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 载入 CMakeLists.txt　文件</span>
INCLUDE<span class="token punctuation">(</span>module <span class="token punctuation">[</span>OPTIONAL<span class="token punctuation">]</span><span class="token punctuation">)</span>　　　 <span class="token comment"># 载入 cmake 模块</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>OPTIONAL</code>参数的作用是文件不存在也不会产生错误。</p> <h2 id="变量参考"><a href="#变量参考" class="header-anchor">#</a> 变量参考</h2> <p>项目目录相关:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 构建发生的目录</span>
CMAKE_BINARY_DIR
PROJECT_BINARY_DIR
<span class="token operator">&lt;</span>projectname<span class="token operator">&gt;</span>_BINARY_DIR

<span class="token comment"># 不论采用何种编译方式，都是工程顶层目录</span>
CMAKE_SOURCE_DIR
PROJECT_SOURCE_DIR
<span class="token operator">&lt;</span>projectname<span class="token operator">&gt;</span>_SOURCE_DIR

CMAKE_CURRENT_SOURCE_DIR  <span class="token comment"># 当前处理的CMakeLists.txt所在的路径</span>

CMAKE_CURRRENT_BINARY_DIR <span class="token comment"># 内部编译: 跟CMAKE_CURRENT_SOURCE_DIR一致</span>
                          <span class="token comment"># 外部编译: 指的是构建目录</span>
                          <span class="token comment"># add_subdirectory(src bin) 会更改它的值为 bin</span>

CMAKE_CURRENT_LIST_FILE   <span class="token comment"># 当前输出所在的CMakeLists.txt的完整路径</span>
CMAKE_CURRENT_LIST_LINE   <span class="token comment"># 当前输出所在的行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>CMAKE_MODULE_PATH         <span class="token comment"># 模块所在路径</span>

EXECUTABLE_OUTPUT_PATH    <span class="token comment"># 可执行文件存放目录</span>
LIBRARY_OUTPUT_PATH       <span class="token comment"># 库存放目录</span>

CMAKE_INCLUDE_DIRECTORIES_PROJECT_BEFORE <span class="token comment"># 将工程提供的头文件目录始终置于系统头文件目录的前面</span>

CMAKE_INCLUDE_PATH        <span class="token comment"># 头文件搜索目录</span>

CMAKE_LIBRARY_PATH        <span class="token comment"># 库搜索目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>系统信息:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>CMAKE_MAJOR_VERSION       <span class="token comment"># CMAKE主版本号，比如2.4.6中的2</span>
CMAKE_MINOR_VERSION       <span class="token comment"># CMAKE次版本号，比如2.4.6中的4</span>
CMAKE_PATCH_VERSION       <span class="token comment"># CMAKE补丁等级，比如2.4.6中的6</span>
CMAKE_SYSTEM              <span class="token comment"># 系统名称，比如Linux-2.6.22</span>
CMAKE_SYSTEM_NAME         <span class="token comment"># 不包含版本的系统名，比如Linux</span>
CMAKE_SYSTEM_VERSION      <span class="token comment"># 系统版本，比如2.6.22</span>
CMAKE_SYSTEM_PROCESSOR    <span class="token comment"># 处理器名称，比如i686</span>
UNIX                      <span class="token comment"># 在所有的类Unix平台为TRUE，包括OSX和cygwin</span>
WIN32                     <span class="token comment"># 在所有的Win32平台为TRUE，包括cygwin</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>开关选项:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS   <span class="token comment"># 用来控制IF ELSE语句的书写方式</span>
BUILD_SHARED_LIBS                   <span class="token comment"># 这个开关用来控制默认的库编译方式: 动态库 静态库</span>
CMAKE_C_FLAGS                       <span class="token comment"># 设置C编译选项</span>
MAKE_CXX_FLAGS                      <span class="token comment"># MAKE_CXX_FLAGS</span>
CMAKE_INCLUDE_CURRENT_DIR           <span class="token comment"># 自动将每个CMakeLists.txt的所在目录依次加入到 头文件搜索目录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>编译参数相关:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_C_FLAGS = &quot;</span> <span class="token variable">${CMAKE_C_FLAGS}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_C_FLAGS_DEBUG = &quot;</span> <span class="token variable">${CMAKE_C_FLAGS_DEBUG}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_C_FLAGS_RELEASE = &quot;</span> <span class="token variable">${CMAKE_C_FLAGS_RELEASE}</span><span class="token punctuation">)</span>

message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_CXX_FLAGS = &quot;</span> <span class="token variable">${CMAKE_CXX_FLAGS}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_CXX_FLAGS_DEBUG = &quot;</span> <span class="token variable">${CMAKE_CXX_FLAGS_DEBUG}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_CXX_FLAGS_RELEASE = &quot;</span> <span class="token variable">${CMAKE_CXX_FLAGS_RELEASE}</span><span class="token punctuation">)</span>

message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_EXE_LINKER_FLAGS = &quot;</span> <span class="token variable">${CMAKE_EXE_LINKER_FLAGS}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_EXE_LINKER_FLAGS_DEBUG = &quot;</span> <span class="token variable">${CMAKE_EXE_LINKER_FLAGS_DEBUG}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_EXE_LINKER_FLAGS_RELEASE = &quot;</span> <span class="token variable">${CMAKE_EXE_LINKER_FLAGS_RELEASE}</span><span class="token punctuation">)</span>

message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_SHARED_LINKER_FLAGS = &quot;</span> <span class="token variable">${CMAKE_SHARED_LINKER_FLAGS}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_SHARED_LINKER_FLAGS_DEBUG = &quot;</span> <span class="token variable">${CMAKE_SHARED_LINKER_FLAGS_DEBUG}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_SHARED_LINKER_FLAGS_RELEASE = &quot;</span> <span class="token variable">${CMAKE_SHARED_LINKER_FLAGS_RELEASE}</span><span class="token punctuation">)</span>

message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_STATIC_LINKER_FLAGS = &quot;</span> <span class="token variable">${CMAKE_STATIC_LINKER_FLAGS}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_STATIC_LINKER_FLAGS_DEBUG = &quot;</span> <span class="token variable">${CMAKE_STATIC_LINKER_FLAGS_DEBUG}</span><span class="token punctuation">)</span>
message<span class="token punctuation">(</span>STATUS <span class="token string">&quot;CMAKE_STATIC_LINKER_FLAGS_RELEASE = &quot;</span> <span class="token variable">${CMAKE_STATIC_LINKER_FLAGS_RELEASE}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="其他参考"><a href="#其他参考" class="header-anchor">#</a> 其他参考</h2> <ul><li><a href="http://www.hahack.com/codes/cmake/" target="_blank" rel="nofollow noopener noreferrer">CMake 入门实战<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/Xiaoyan-Li/p/5674747.html" target="_blank" rel="nofollow noopener noreferrer">CMake Official Tutorial——教程还是官方的好<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/luanpeng825485697/article/details/81202136" target="_blank" rel="nofollow noopener noreferrer">cmake 教程 基本语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=cmake" title="标签">#cmake</a></div> <div class="last-updated"><span class="prefix">Last Update:</span> <span class="time">2021/12/22, 22:24:18</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/91f115/" class="prev">Markdown语法</a></span> <span class="next"><a href="/pages/12fc61/">GitHub自动同步到Gitee</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/sumcai" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-smctop1" style="display:none;"></div> <div title="切换主题" class="button blur theme-mode-but iconfont icon-smcyue1"></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
<script src="/assets/js/app.29891e4d.js" defer></script><script src="/assets/js/2.a7472eed.js" defer></script><script src="/assets/js/4.705083b4.js" defer></script><script src="/assets/js/53.72f8b89b.js" defer></script>
</body>
</html>